<!DOCTYPE html>
<html lang="en">

  <!-- Head -->
  <head>    <!-- Metadata, OpenGraph and Schema.org -->
    
    <!-- Website verification -->
    <meta name="google-site-verification" content="wsO-UoFBy8qjM2ragwE8hKRdfnHREv0KZUshjAm5u0g" />

    <!-- Standard metadata -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Yunhak  Oh | Conda를 이용한 간단한 GPU버전 JAX 설치법</title>
    <meta name="author" content="Yunhak  Oh" />
    <meta name="description" content="CUDA, cuDNN 버전 때문에 골치 아팠던 JAX 설치기" />


    <!-- Bootstrap & MDB -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous" />

    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">

    <!-- Code Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="none" id="highlight_theme_light" />

    <!-- Styles -->
    
    <link rel="shortcut icon" href="/assets/img/scientist.ico"/>
    
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="canonical" href="https://yunhak0.github.io/blog/2024/install-jax/">
    
    <!-- Dark Mode -->
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark" />

    <script src="/assets/js/theme.js"></script>
    <script src="/assets/js/dark_mode.js"></script>
    

  </head>

  <!-- Body -->
  <body class="fixed-top-nav ">

    <!-- Header -->
    <header>

      <!-- Nav Bar -->
      <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
        <div class="container">
          <a class="navbar-brand title font-weight-lighter" href="https://yunhak0.github.io/"><span class="font-weight-bold">Yunhak</span>   Oh</a>
          <!-- Navbar Toggle -->
          <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar top-bar"></span>
            <span class="icon-bar middle-bar"></span>
            <span class="icon-bar bottom-bar"></span>
          </button>

          <div class="collapse navbar-collapse text-right" id="navbarNav">
            <ul class="navbar-nav ml-auto flex-nowrap">

              <!-- About -->
              <li class="nav-item ">
                <a class="nav-link" href="/">About</a>
              </li>

              <!-- CV -->
              <li class="nav-item ">
                <a class="nav-link" href="/assets/pdf/CV_YunhakOh.pdf">CV</a>
              </li>

              
              <!-- Blog -->
              <li class="nav-item active">
                <a class="nav-link" href="/blog/">Blog</a>
              </li>

              <!-- Other pages -->
              <li class="nav-item ">
                <a class="nav-link" href="/publications/">Publications</a>
              </li>

              <!-- Toogle theme mode -->
              <div class="toggle-container">
                <a id="light-toggle">
                  <i class="fas fa-moon"></i>
                  <i class="fas fa-sun"></i>
                </a>
              </div>
            </ul>
          </div>
        </div>
      </nav>
    </header>

    <!-- Content -->
    <div class="container mt-5">
      <!-- _layouts/post.html -->

<div class="post">

  <header class="post-header">
    <h1 class="post-title">Conda를 이용한 간단한 GPU버전 JAX 설치법</h1>
    <p class="post-meta">March 11, 2024</p>
    <p class="post-tags">
      <a href="/blog/2024"> <i class="fas fa-calendar fa-sm"></i> 2024 </a>
        ·  
        <a href="/blog/tag/jax">
          <i class="fas fa-hashtag fa-sm"></i> jax</a>  
          
        ·  
        <a href="/blog/category/setting">
          <i class="fas fa-tag fa-sm"></i> setting</a>  
          

    </p>
  </header>

  <article class="post-content">
    <p><em>이 포스트는 2024년 3월 12일을 기준으로 작성되었습니다.</em></p>

<p>Antibody design을 위해 JAX를 설치해야 하는 상황에 생겼다. (pytorch, tensorflow 정도로 끝날 줄 알았는데…)</p>

<p>공식 홈페이지의 <a href="https://jax.readthedocs.io/en/latest/installation.html#nvidia-gpu" target="_blank" rel="noopener noreferrer">Installation Guideline</a> 대로 설치를 시도했다. (먼저 <code class="language-plaintext highlighter-rouge">conda</code> 환경 만들기!)</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
</pre></td>
<td class="code"><pre>  <span class="c"># Create Conda Environment (python 3.9)</span>
  conda create <span class="nt">-n</span> af <span class="nv">python</span><span class="o">=</span>3.9
  conda activate af
</pre></td>
</tr></tbody></table></code></pre></figure>

<h3 id="시도-1">[시도 1]</h3>
<p><br>
하지만, CUDA 버전 (v11.1)이 너무 낮아, GPU를 인식하지 못하는 문제가 발생하였다.</p>
<details>
  <summary>자세히</summary>
    CUDA version이 다음과 같이 다르게 나타났지만(<a href="https://stackoverflow.com/questions/53422407/different-cuda-versions-shown-by-nvcc-and-nvidia-smi" target="_blank" rel="noopener noreferrer">차이가 나는 이유</a>), 11.x라 공식 Guideline인 <a href="https://jax.readthedocs.io/en/latest/installation.html#nvidia-gpu" target="_blank" rel="noopener noreferrer">Installing JAX</a>에서 'CUDA 11 installation' 코드로 설치 시도함.
  
<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
</pre></td>
<td class="code"><pre>  nvidia-smi
</pre></td>
</tr></tbody></table></code></pre></figure>

    <img width="800" src="/assets/img/blog1_install_jax/nvidia-smi_results.png">

  
<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
</pre></td>
<td class="code"><pre>  nvcc <span class="nt">--version</span>
</pre></td>
</tr></tbody></table></code></pre></figure>

    <img width="500" src="/assets/img/blog1_install_jax/nvcc_results.png">

    <br>


<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
</pre></td>
<td class="code"><pre>  <span class="c"># CUDA 11 installation</span>
  <span class="c"># Note: wheels only available on linux.</span>
  pip <span class="nb">install</span> <span class="nt">--upgrade</span> <span class="s2">"jax[cuda11_pip]"</span> <span class="nt">-f</span> https://storage.googleapis.com/jax-releases/jax_cuda_releases.html
</pre></td>
</tr></tbody></table></code></pre></figure>



<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
</pre></td>
<td class="code"><pre>  <span class="n">python</span>
  <span class="kn">from</span> <span class="n">jax.lib</span> <span class="kn">import</span> <span class="n">xla_bridge</span>
  <span class="nf">print</span><span class="p">(</span><span class="n">xla_bridge</span><span class="p">.</span><span class="nf">get_backend</span><span class="p">().</span><span class="n">platform</span><span class="p">)</span>
</pre></td>
</tr></tbody></table></code></pre></figure>


Log 메세지를 통해 CUDA version이 너무 낮음을 알 수 있었다.<br>

    <!-- <img width="500" src='/assets/img/blog1_install_jax/jax_check.png'>

    <br> -->

</details>
<div style="color:red;">CUDA backend failed to initialize: Found cuBLAS version 11201, but JAX was built against version 111103, which is newer. The copy of cuBLAS that is installed must be at least as new as the version against which JAX built. (Set TF_CPP_MIN_LOG_LEVEL=0 and rerun for more info.)<br>
cpu</div>
<p><br></p>

<h3 id="시도-2">[시도 2]</h3>
<p><br>
CUDA 버전을 업데이트 하기 위해 <a href="https://docs.nvidia.com/cuda/cuda-installation-guide-linux/index.html" target="_blank" rel="noopener noreferrer">공식 문서</a>를 참고하여,</p>

<ol>
  <li>리눅스 버전</li>
  <li>GPU 모델</li>
</ol>

<p>확인 후 <a href="https://developer.nvidia.com/cuda-downloads" target="_blank" rel="noopener noreferrer">CUDA toolkit</a> v12.4와 <a href="https://developer.nvidia.com/rdp/cudnn-archive" target="_blank" rel="noopener noreferrer">cuDNN</a> v8.9.7 for CUDA 12.x 를 설치하였으나, 어떤 이유에서 인지… 이번에도 GPU를 인식하지 못하는 문제가 발생하였다.</p>
<details>
  <summary>자세히</summary>
    <img width="800" src="/assets/img/blog1_install_jax/env_setup.png">

    <br>


<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td>
<td class="code"><pre>  <span class="c"># in .bash_profile</span>
  <span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span>/usr/local/cuda-12.4/bin<span class="k">${</span><span class="nv">PATH</span>:+:<span class="k">${</span><span class="nv">PATH</span><span class="k">}}</span>
  <span class="nb">export </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span>/usr/local/cuda-12.4/lib64<span class="k">${</span><span class="nv">LD_LIBRARY_PATH</span>:+:<span class="k">${</span><span class="nv">LD_LIBRARY_PATH</span><span class="k">}}</span>

  <span class="c"># after save</span>
  <span class="nb">source</span> ~/.bash_profile
</pre></td>
</tr></tbody></table></code></pre></figure>

</details>

<p><br></p>

<h3 id="시도-3">[시도 3]</h3>
<p><br>
그리고 <code class="language-plaintext highlighter-rouge">conda</code>를 활용해 설치하는 <a href="https://jax.readthedocs.io/en/latest/installation.html#conda" target="_blank" rel="noopener noreferrer">방법</a>을 시도했지만, 어째서인지 명령어가 먹히지 않았다.</p>

<details>
  <summary>자세히</summary>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
</pre></td>
<td class="code"><pre>  conda <span class="nb">install </span>jax <span class="nt">-c</span> conda-forge
  conda <span class="nb">install </span><span class="nv">jaxlib</span><span class="o">=</span><span class="k">*</span><span class="o">=</span><span class="k">*</span>cuda<span class="k">*</span> jax cuda-nvcc <span class="nt">-c</span> conda-forge <span class="nt">-c</span> nvidia
</pre></td>
</tr></tbody></table></code></pre></figure>

    <!-- <img width="500" src='/assets/img/blog1_install_jax/conda_jaxlib_trial.png'> -->
</details>
<div style="color:red;">no matches found: jaxlib=*=*cuda*</div>
<p><br></p>

<h2 id="설치-성공한-방법">설치 성공한 방법</h2>

<p>마지막으로 아래와 같이 시도해서 성공했다.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
</pre></td>
<td class="code"><pre><span class="c"># create conda environment</span>
conda create <span class="nt">-n</span> af <span class="nv">python</span><span class="o">=</span>3.9
conda activate af
</pre></td>
</tr></tbody></table></code></pre></figure>

<p>처음에는 CUDA 12.4 버전을 설치하려고 했지만, <code class="language-plaintext highlighter-rouge">conda</code>에서 설치 가능한 <a href="https://anaconda.org/anaconda/cudnn" target="_blank" rel="noopener noreferrer">cudnn</a> version이 <a href="https://anaconda.org/nvidia/cuda" target="_blank" rel="noopener noreferrer">CUDA 11</a>을 기반으로 하기 때문에, 11.8 버전을 <a href="https://jax.readthedocs.io/en/latest/installation.html#pip-installation-gpu-cuda-installed-locally-harder" target="_blank" rel="noopener noreferrer">기준</a>으로 설치하였다.</p>

<blockquote>
  <p>JAX currently ships two CUDA wheel variants:</p>
  <ul>
    <li>CUDA 12.3, cuDNN 8.9, NCCL 2.16</li>
    <li>CUDA 11.8, cuDNN 8.6, NCCL 2.16</li>
  </ul>
</blockquote>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td>
<td class="code"><pre>  <span class="c"># install cuda using conda</span>
  conda <span class="nb">install </span>nvidia/label/cuda-11.8.0::cuda

  <span class="c"># install cudnn using conda</span>
  conda <span class="nb">install </span>anaconda::cudnn
</pre></td>
</tr></tbody></table></code></pre></figure>

<p>그리고 JAX를 conda로 설치했는데, 설치된 jax 버전 (v0.4.25)과 jaxlib 버전 (v0.4.23)이 달라, 이를 맞추기 위해 최종적으로 아래와 같이 설치하였다.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
</pre></td>
<td class="code"><pre>  <span class="c"># install jax using conda</span>
  conda <span class="nb">install </span><span class="nv">jax</span><span class="o">==</span>0.4.23 <span class="nt">-c</span> conda-forge
</pre></td>
</tr></tbody></table></code></pre></figure>

<p>gpu 버전인 jaxlib 설치를 위해 jaxlib만 pip를 사용해 설치해주었다.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
</pre></td>
<td class="code"><pre>  <span class="c"># install jaxlib for gpu using conda</span>
  pip <span class="nb">install </span><span class="nv">jaxlib</span><span class="o">==</span>0.4.23+cuda11.cudnn86 <span class="nt">-f</span> https://storage.googleapis.com/jax-releases/jax_cuda_releases.html
</pre></td>
</tr></tbody></table></code></pre></figure>

<p><img width="800" src="/assets/img/blog1_install_jax/success.png"></p>

  </article><div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_shortname  = 'yunhak0-github-io';
      var disqus_identifier = '/blog/2024/install-jax';
      var disqus_title      = "Conda를 이용한 간단한 GPU버전 JAX 설치법";
      (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript" target="_blank" rel="noopener noreferrer">comments powered by Disqus.</a>
</noscript>

</div>

    </div>

    <!-- Footer -->    
    <footer class="fixed-bottom">
      <div class="container mt-0">
        © Copyright 2025 Yunhak  Oh. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="noopener noreferrer">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" target="_blank" rel="noopener noreferrer">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="noopener noreferrer">GitHub Pages</a>.

      </div>
    </footer>

    <!-- JavaScripts -->
    <!-- jQuery -->
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

    <!-- Bootsrap & MDB scripts -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.2/dist/umd/popper.min.js" integrity="sha256-l/1pMF/+J4TThfgARS6KwWrk/egwuVvhRzfLAMQ6Ds4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js" integrity="sha256-SyTu6CwrfOhaznYZPoolVw2rxoY7lKYKQvqbtqN93HI=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script>

    <!-- Masonry & imagesLoaded -->
  <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
  <script defer src="/assets/js/masonry.js" type="text/javascript"></script>
    
  <!-- Medium Zoom JS -->
  <script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script>
  <script src="/assets/js/zoom.js"></script><!-- Load Common JS -->
  <script src="/assets/js/common.js"></script>

    <!-- MathJax -->
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        tags: 'ams'
      }
    };
  </script>
  <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script>
  <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-6KWPNF767R"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-6KWPNF767R');
  </script>
  </body>
</html>

